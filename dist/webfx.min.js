!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).webfx={})}(this,(function(t){"use strict";var e=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(n,s){function r(t){try{l(o.next(t))}catch(t){s(t)}}function a(t){try{l(o.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((o=o.apply(t,e||[])).next())}))};const i=Object.assign,o=Object.prototype.hasOwnProperty;var n=new class{constructor(){this.fileSizeUnits=["B","KB","MB","GB"],this.buildDOM=null,this.jsxFactory=null,this.jsx=null}strPadLeft(t,e,i=" "){for(;t.length<e;)t=i+t;return t}formatTime(t){if("number"!=typeof t||isNaN(t))return"--:--";t=Math.round(t);var e=Math.floor(t/60);return t%=60,this.strPadLeft(e.toString(),2,"0")+":"+this.strPadLeft(t.toString(),2,"0")}formatFileSize(t){if("number"!=typeof t||isNaN(t))return"NaN";for(var e=0;e<this.fileSizeUnits.length-1&&t>=1024;)e++,t/=1024;return t.toFixed(2)+" "+this.fileSizeUnits[e]}formatDateTime(t){var e=new Date;return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()?t.toLocaleTimeString():t.toLocaleString()}numLimit(t,e,i){return t<e||"number"!=typeof t||isNaN(t)?e:t>i?i:t}createName(t,e){for(let i=0;;i++){let o=t(i);if(!e(o))return o}}base64EncodeUtf8(t){return btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode("0x"+e)})))}sleepAsync(t){return new Promise((e=>{setTimeout(e,t)}))}clearChildren(t){for(;t.lastChild;)t.removeChild(t.lastChild)}replaceChild(t,e){this.clearChildren(t),e&&t.appendChild(e)}toggleClass(t,e,i){var o=t.classList;return o.toggle?o.toggle(e,i):(void 0===i&&(i=!o.contains(e)),i?o.add(e):o.remove(e),i)}fadeout(t,e){const{className:i="fading-out",duration:o=500,waitTransition:n=!0}=e||{};t.classList.add(i);var s=null,r=()=>{r&&(r=null,n&&t.removeEventListener("transitionend",a),t.classList.remove(i),t.remove(),s&&s())};if(n){var a=function(t){t.eventPhase===Event.AT_TARGET&&r()};t.addEventListener("transitionend",a)}return setTimeout(r,o),{get finished(){return!r},onFinished(t){r?s=t:t()},cancel(){null==r||r()}}}listenPointerEvents(t,e,i){var o=!1,n=function(t){if("track"===e({type:"mouse",ev:t,point:t,action:"down"})){var i=function(t){e({type:"mouse",ev:t,point:t,action:"move"})},o=function(t){document.removeEventListener("mousemove",i,!0),document.removeEventListener("mouseup",o,!0),e({type:"mouse",ev:t,point:t,action:"up"})};document.addEventListener("mousemove",i,!0),document.addEventListener("mouseup",o,!0)}},s=function(n){var s=n.changedTouches[0],r=e({type:"touch",touch:"start",ev:n,point:s,action:o?"move":"down"});if(!o&&"track"===r){o=!0;var a=function(t){var i=t.changedTouches[0];e({type:"touch",touch:"move",ev:t,point:i,action:"move"})},l=function(i){0===i.touches.length&&(o=!1,t.removeEventListener("touchmove",a),t.removeEventListener("touchend",l));var n=i.changedTouches[0];e({type:"touch",touch:"end",ev:i,point:n,action:o?"move":"up"})};t.addEventListener("touchmove",a,i),t.addEventListener("touchend",l,i)}};return t.addEventListener("mousedown",n,i),t.addEventListener("touchstart",s,i),{remove:()=>{t.removeEventListener("mousedown",n,i),t.removeEventListener("touchstart",s,i)}}}listenEvent(t,e,i){return t.addEventListener(e,i),{remove:()=>t.removeEventListener(e,i)}}listenEvents(t,e,i){return e.forEach((e=>t.addEventListener(e,i))),{remove:()=>e.forEach((e=>t.removeEventListener(e,i)))}}injectCss(t,e){var i;document.head.appendChild(n.buildDOM({tag:null!==(i=null==e?void 0:e.tag)&&void 0!==i?i:"style",text:t}))}arrayRemove(t,e){for(let i=0;i<t.length;i++)t[i]===e&&(t.splice(i,1),i--)}arrayInsert(t,e,i){void 0===i?t.push(e):t.splice(i,0,e)}arrayMap(t,e){if(t instanceof Array)return t.map(e);var i=0,o=new Array(t.length);for(var n of t)o[i]=e(n,i),i++;return o}arrayForeach(t,e){var i=0;for(var o of t)e(o,i++)}arrayFind(t,e){if(t instanceof Array)return t.find(e);var i=0;for(var o of t)if(e(o,i++))return o;return null}arraySum(t,e){var i=0;return this.arrayForeach(t,(t=>{var o=e(t);o&&(i+=o)})),i}objectApply(t,e,n){if(e){if(!n)return i(t,e);for(const i in e)if(o.call(e,i)&&(!n||n.indexOf(i)>=0)){const o=e[i];t[i]=o}}return t}mod(t,e){return t<0&&(t=e+t),t%e}readBlobAsDataUrl(t){return new Promise(((e,i)=>{var o=new FileReader;o.onload=t=>{e(o.result)},o.onerror=t=>i(),o.readAsDataURL(t)}))}};Array.prototype.remove=function(t){n.arrayRemove(this,t)};class s{constructor(t){this.callback=t,this.cancelFunc=void 0}timeout(t){this.tryCancel();var e=setTimeout(this.callback,t);this.cancelFunc=()=>window.clearTimeout(e)}interval(t){this.tryCancel();var e=setInterval(this.callback,t);this.cancelFunc=()=>window.clearInterval(e)}animationFrame(){this.tryCancel();var t=requestAnimationFrame(this.callback);this.cancelFunc=()=>cancelAnimationFrame(t)}tryCancel(){this.cancelFunc&&(this.cancelFunc(),this.cancelFunc=void 0)}}n.Timer=s;class r{constructor(t,e,i){if(this.onRender=null,this.key=t,!(e=this.type="string"==typeof e?r.types[e]:e)||!e.serialize||!e.deserialize)throw new Error("invalid 'type' arugment");this.readFromStorage(i)}readFromStorage(t){var e=this.key?localStorage.getItem(this.key):null;this.isInitial=!e,this.set(e?this.type.deserialize(e):t,!0)}render(t,e){e||t(this.data);const i=this.onRender,o=t;return i&&(t=function(t){i(t),o(t)}),this.onRender=t,this}bindToBtn(t,e){if(this.type!==r.types.bool)throw new Error("only for bool type");var i=document.createElement("span");t.insertBefore(i,t.firstChild),this.render((function(o){t.classList.toggle("disabled",!o),e=e||["❌","✅"],i.textContent=e[+o]}));var o=this;return t.addEventListener("click",(function(){o.toggle()})),this}remove(){localStorage.removeItem(this.key)}save(){this.isInitial=!1,localStorage.setItem(this.key,this.type.serialize(this.data))}set(t,e){this.data=t,this.isInitial=!1,this.onRender&&this.onRender(t),!e&&this.key&&this.save()}get(){return this.data}toggle(){if(this.type!==r.types.bool)throw new Error("only for bool type");this.set(!this.data)}loop(t){var e=this.data,i=t.findIndex((function(t){return t===e})),o=t[(i+1)%t.length];this.set(o)}}r.types={bool:{serialize:function(t){return t?"true":"false"},deserialize:function(t){return"true"===t||"false"!==t&&void 0}},str:{serialize:function(t){return t},deserialize:function(t){return t}},json:{serialize:function(t){return JSON.stringify(t)},deserialize:function(t){return JSON.parse(t)}}};class a{constructor(){this.list=null}invoke(...t){var e;null===(e=this.list)||void 0===e||e.forEach((e=>e.apply(this,t)))}add(t){return this.list?this.list.push(t):this.list=[t],t}remove(t){this.list&&this.list.remove(t)}}class l{constructor(t){this.dict=null!=t?t:{}}static EnsureCtx(t,e){var i;return i=t instanceof l?t:new l(t),e&&(e.actions||(e.actions=[]),i.actions=e.actions),i}setDict(t,e){this.dict||(this.dict={}),this.dict[t]=e}addUpdateAction(t){this.actions||(this.actions=[]),this.actions.push(t)}update(){if(this.actions)for(const t of this.actions)l.executeAction(t)}static executeAction(t){switch(t[0]){case"text":t[1].textContent=t[2]();break;case"hidden":t[1].hidden=t[2]();break;case"update":t[2](t[1]);break;default:console.warn("unknown action",t)}}}function d(t,e){if("string"==typeof t)return document.createTextNode(t);if("function"==typeof t){const i=t();if(i&&"object"==typeof i)throw new Error("Unexpected function return value");{const o=document.createTextNode(i);return null==e||e.addUpdateAction(["text",o,t]),o}}return Node&&t instanceof Node?t:null}var c=function(t,e,i){if(e--<0)throw new Error("ran out of TTL");var o=d(t,i);if(o)return o;if(t instanceof m)return t.buildDom(i,e);if("getDOM"in t)return t.getDOM();const n=t.tag;if(!n)throw new Error("no tag");var s=function(t){for(var e,i,o=/[#\.^]?[\w\-]+/y;e=o.exec(t);){var n=e[0],s=n[0];if("."===s)i.classList.add(n.substr(1));else if("#"===s)i.id=n.substr(1);else{if(i)throw new Error("unexpected multiple tags");i=document.createElement(n)}}return i}(n);for(var r in t._ctx&&(i=l.EnsureCtx(t._ctx,i)),t)if(t.hasOwnProperty(r)){var a=t[r];h(r,a,s,i,e)}const c=t.init;return c&&c(s),s},h=function(t,e,i,o,n){"child"===t?e instanceof Array?e.forEach((function(t){t instanceof Array?t.forEach((function(t){i.appendChild(c(t,n,o))})):i.appendChild(c(t,n,o))})):i.appendChild(c(e,n,o)):"_key"===t?o.setDict(e,i):"text"===t?"function"==typeof e?o.addUpdateAction(["text",i,e]):i.textContent=e:"class"===t?i.className=e:"hidden"===t&&"function"==typeof e?o.addUpdateAction(["hidden",i,e]):"update"===t&&"function"==typeof e?o.addUpdateAction(["update",i,e]):"init"===t||(i[t]=e)};const u=n.buildDOM=function(t,e){return c(t,32,e)};class m{constructor(t,e,i){this.tag=t,this.attrs=e,this.child=i}getDOM(){return this.buildDom(null,64)}_getDOMExpr(){return Object.assign({tag:this.tag,child:this.child},this.attrs)}buildDom(t,e){return this.buildView(t,e).getDOM()}buildView(t,e){if(e--<0)throw new Error("ran out of TTL");if("string"==typeof this.tag)return c(this._getDOMExpr(),e,t);if(this.child)for(const i of this.child)i instanceof Array?i.forEach((i=>this.tag.addChild(g(i,e,t)))):this.tag.addChild(g(i,e,t));return this.tag}addChild(t){null==this.child&&(this.child=[]),this.child.push(t)}}function g(t,e,i){if(e--<0)throw new Error("ran out of TTL");var o=d(t,i);if(o)return o;if(t instanceof m)return t.buildView(i,e);throw new Error("Unknown node type")}function p(t,e,...i){return"string"==typeof t?new m(t,e,i):new m(new t(e),void 0,i)}const v=n.jsx=n.jsxFactory=p;class f{constructor(t){this.parentView=void 0,this._position=void 0,this.domctx=new l,this._dom=void 0,this._onactive=void 0,this._onActiveCbs=void 0,t&&this.domExprCreated(t)}static getView(t){return t instanceof f?t:new f(t)}get position(){return this._position}get domCreated(){return!!this._dom}get dom(){return this.ensureDom(),this._dom}get hidden(){return this.dom.hidden}set hidden(t){this.dom.hidden=t}ensureDom(){if(!this._dom){var t=this.createDom();this.domExprCreated(t)}}domExprCreated(t){this._dom=n.buildDOM(t,this.domctx),this.postCreateDom(),this.updateDom()}createDom(){return document.createElement("div")}postCreateDom(){}updateDom(){this.domctx.update()}updateWith(t){n.objectApply(this,t),this.updateDom()}toggleClass(t,e){n.toggleClass(this.dom,t,e)}appendView(t){return this.dom.appendView(t)}getDOM(){return this.dom}addChild(t){t instanceof f?this.appendView(t):this.dom.appendChild(n.buildDOM(t))}get onactive(){return this._onactive}set onactive(t){!!this._onactive!=!!t&&(t?(this._onActiveCbs=[t=>{this._onactive(t)},t=>{this.handleKeyDown(t,this._onactive)}],this.dom.addEventListener("click",this._onActiveCbs[0]),this.dom.addEventListener("keydown",this._onActiveCbs[1])):(this.dom.removeEventListener("click",this._onActiveCbs[0]),this.dom.removeEventListener("keydown",this._onActiveCbs[1]),this._onActiveCbs=void 0)),this._onactive=t}handleKeyDown(t,e){if("Enter"===t.code){const i=this.dom.getBoundingClientRect();e(new MouseEvent("click",{clientX:i.x,clientY:i.y,relatedTarget:this.dom})),t.preventDefault()}}}Node.prototype.getDOM=function(){return this},Node.prototype.addChild=function(t){this.appendChild(n.buildDOM(t))},Node.prototype.appendView=function(t){this.appendChild(t.dom)};class w extends f{constructor(){super(...arguments),this.items=[]}appendView(t){this.addView(t)}addView(t,e){const i=this.items;if(t.parentView)throw new Error("the view is already in a container view");if(t.parentView=this,void 0===e)t._position=i.length,i.push(t),this._insertToDom(t,i.length-1);else{i.splice(e,0,t);for(let t=e;t<i.length;t++)i[t]._position=t;this._insertToDom(t,e)}}removeView(t){t=this._ensureItem(t),this._removeFromDom(t);var e=t._position;t.parentView=t._position=void 0,this.items.splice(e,1);for(let t=e;t<this.items.length;t++)this.items[t]._position=t}removeAllView(){for(;this.length;)this.removeView(this.length-1)}updateChildrenDom(){for(const t of this.items)t.updateDom()}_insertToDom(t,e){var i;e==this.items.length-1?this.dom.appendChild(t.dom):this.dom.insertBefore(t.dom,(null===(i=this.items[e+1])||void 0===i?void 0:i.dom)||null)}_removeFromDom(t){t.domCreated&&t.dom.remove()}_ensureItem(t){if("number"==typeof t)t=this.items[t];else{if(!t)throw new Error("item is null or undefined.");if(t.parentView!==this)throw new Error("the item is not in this listview.")}return t}[Symbol.iterator](){return this.items[Symbol.iterator]()}get length(){return this.items.length}get(t){return this.items[t]}map(t){return n.arrayMap(this,t)}find(t){return n.arrayFind(this,t)}forEach(t){return n.arrayForeach(this,t)}}class b{constructor(){this.data={},this.curLang="en",this.missing=new Map}get(t,e){return this.get2(t,e)||t}get2(t,e,i){i=i||this.curLang;var o=this.data[i];if(!o)return console.log("i18n missing lang: "+i),null;var n=o[t];if(!n)return this.missing.has(t)||(this.missing.set(t,1),console.log("i18n missing key: "+t)),null;if(e)for(const t in e)if(e.hasOwnProperty(t)){const i=e[t];n=n.replace("{"+t+"}",i)}return n}add2dArray(t){const e=[],i=t[0];for(const t of i)e.push(this.data[t]=this.data[t]||{});for(let i=1;i<t.length;i++){const o=t[i],n=o[0];for(let t=0;t<o.length;t++){const i=o[t];e[t][n]=i}}}renderElements(t){console.log("i18n elements rendering"),t.forEach((t=>{for(const i of t.childNodes)if(i.nodeType===Node.TEXT_NODE){var e=this.get2(i.beforeI18n||i.textContent);e?(i.beforeI18n=i.beforeI18n||i.textContent,i.textContent=e):(i.beforeI18n&&(i.textContent=i.beforeI18n),console.log("missing key for node",i))}}))}static detectLanguage(t){var e=null,i=-1,o=[];return(navigator.languages||[navigator.language]).forEach((t=>{o.push(t),t.indexOf("-")>0&&o.push(t.substr(0,t.indexOf("-")))})),t.forEach((t=>{var n=o.indexOf(t);(!e||-1!==n&&n<i)&&(e=t,i=n)})),e||t[0]}}function x(t){var e=y(t);return function(i,...o){return 0===o.length?t.get(i[0]):e(i,...o).join("")}}function y(t){var e=new WeakMap,i=new Map;return function(o,...n){if(0===n.length)return[t.get(o[0])];let s=e.get(o);if(void 0===s){s="";for(let t=0;t<o.length;t++){s+=o[t],t<n.length&&(s+="{"+t+"}")}e.set(o,s)}const r=t.get(s);let a=i.get(r);return void 0===a&&(a=function(t){const e=[];let i=0,o="";for(let n=0;n<t.length;n++){const s=t[n];switch(s){case"{":if(0==i)i=1;else{if(1!=i)throw new Error(`Expected number, got '${s}' at ${n}`);i=0,o+="{"}break;case"}":if(3==i)i=0,e.push(+o),o="";else if(0==i)i=2;else{if(2!=i)throw new Error(`Expected number, got '${s}' at ${n}`);i=0,o+="}"}break;default:if(2==i)throw new Error(`Expected '}', got '${s}' at ${n}`);1==i&&(i=3,o&&e.push(o),o=""),o+=s}}if(0!=i)throw new Error("Unexpected end of template string");o&&e.push(o);return e}(r)),a.map((t=>"number"==typeof t?n[t]:t))}}var C=new b;const k=x(C);var _=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(n,s){function r(t){try{l(o.next(t))}catch(t){s(t)}}function a(t){try{l(o.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((o=o.apply(t,e||[])).next())}))};function D(){return':root {--color-bg: white;--color-text: black;--color-text-gray: #666;--color-bg-selection: hsl(5, 100%, 85%);--color-primary: hsl(5, 100%, 67%);--color-primary-darker: hsl(5, 100%, 60%);--color-primary-dark: hsl(5, 100%, 40%);--color-primary-dark-depends: hsl(5, 100%, 40%);--color-primary-verydark: hsl(5, 100%, 20%);--color-primary-light: hsl(5, 100%, 83%);--color-primary-lighter: hsl(5, 100%, 70%);--color-fg-11: #111111;--color-fg-22: #222222;--color-fg-33: #333333;--color-bg-cc: #cccccc;--color-bg-dd: #dddddd;--color-bg-ee: #eeeeee;--color-bg-f8: #f8f8f8;--color-shadow: rgba(0, 0, 0, .5);}.no-selection {user-select: none;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;}/* listview item */.item {display: block;padding: 10px;/* background: #ddd; *//* animation: showing .3s forwards; */text-decoration: none;line-height: 1.2;}a.item {color: inherit;}.clickable, .item {cursor: pointer;transition: transform .3s;-webkit-tap-highlight-color: transparent;}.item:hover, .dragover {background: var(--color-bg-ee);}.keyboard-input .item:focus {outline-offset: -2px;}.dragover-placeholder {/* border-top: 2px solid gray; */position: relative;}.dragover-placeholder::before {content: "";display: block;position: absolute;transform: translate(0, -1px);height: 2px;width: 100%;background: gray;z-index: 100;pointer-events: none;}.clickable:active, .item:active {transition: transform .07s;transform: scale(.97);}.item:active {background: var(--color-bg-dd);}.item.no-transform:active {transform: none;}.item.active {background: var(--color-bg-dd);}.loading-indicator {position: relative;margin: .3em;margin-top: 3em;margin-bottom: 1em;text-align: center;white-space: pre-wrap;cursor: default;animation: loading-fadein .3s;}.loading-indicator-text {margin: 0 auto;}.loading-indicator.running .loading-indicator-inner {display: inline-block;position: relative;vertical-align: bottom;}.loading-indicator.running .loading-indicator-inner::after {content: "";height: 1px;margin: 0%;background: var(--color-text);display: block;animation: fadein .5s 1s backwards;}.loading-indicator.running .loading-indicator-text {margin: 0 .5em;animation: fadein .3s, loading-first .3s .5s cubic-bezier(0.55, 0.055, 0.675, 0.19) reverse, loading-second .3s .8s cubic-bezier(0.55, 0.055, 0.675, 0.19), loading .25s 1.1s cubic-bezier(0.55, 0.055, 0.675, 0.19) alternate-reverse infinite;}.loading-indicator.error {color: red;}.loading-indicator.fading-out {transition: max-height;animation: loading-fadein .3s reverse;}@keyframes loading-fadein {0% {opacity: 0;max-height: 0;}100% {opacity: 1;max-height: 200px;}}@keyframes fadein {0% {opacity: 0;}100% {opacity: 1;}}@keyframes loading-first {0% {transform: translate(0, -2em) scale(1) rotate(360deg);}100% {transform: translate(0, 0) scale(1) rotate(0deg);}}@keyframes loading-second {0% {transform: translate(0, -2em);}100% {transform: translate(0, 0);}}@keyframes loading {0% {transform: translate(0, -1em);}100% {transform: translate(0, 0);}}@keyframes showing {0% {opacity: .3;transform: translate(-20px, 0)}100% {opacity: 1;transform: translate(0, 0)}}@keyframes showing-top {0% {opacity: .3;transform: translate(0, -20px)}100% {opacity: 1;transform: translate(0, 0)}}@keyframes showing-right {0% {opacity: .3;transform: translate(20px, 0)}100% {opacity: 1;transform: translate(0, 0)}}.overlay {background: rgba(0, 0, 0, .2);position: absolute;top: 0;left: 0;right: 0;bottom: 0;animation: fadein .3s;z-index: 10001;overflow: hidden;contain: strict;will-change: transform;}.overlay.fixed {position: fixed;}.overlay.nobg {background: none;will-change: auto;}.overlay.centerchild {display: flex;align-items: center;justify-content: center;}.dialog * {box-sizing: border-box;}.dialog {font-size: 14px;position: relative;overflow: auto;background: var(--color-bg);border-radius: 5px;box-shadow: 0 0 12px var(--color-shadow);animation: dialogin .2s ease-out;z-index: 10001;display: flex;flex-direction: column;max-height: 100%;contain: content;will-change: transform;}.dialog.resize {resize: both;}.fading-out .dialog {transition: transform .3s ease-in;transform: scale(.85);}.dialog-title, .dialog-content, .dialog-bottom {padding: 10px;}.dialog-title {background: var(--color-bg-ee);}.dialog-content {flex: 1;padding: 5px 10px;overflow: auto;}.dialog-content.flex {display: flex;flex-direction: column;}.dialog-bottom {padding: 5px 10px;}@keyframes dialogin {0% {transform: scale(.85);}100% {transform: scale(1);}}.input-label {font-size: 80%;color: var(--color-text-gray);margin: 5px 0 3px 0;}.input-text {display: block;width: 100%;padding: 5px;border: solid 1px gray;background: var(--color-bg);color: var(--color-text);}.dialog .input-text {margin: 5px 0;}textarea.input-text {resize: vertical;}.labeled-input {display: flex;flex-direction: column;}.labeled-input .input-text {flex: 1;}.labeled-input:focus-within .input-label {color: var(--color-primary-darker);}.input-text:focus {border-color: var(--color-primary-darker);}.input-text:active {border-color: var(--color-primary-dark);}.btn {display: block;text-align: center;transition: all .2s;padding: 0 .4em;min-width: 3em;line-height: 1.5em;background: var(--color-primary);color: white;text-shadow: 0 0 4px var(--color-primary-verydark);box-shadow: 0 0 3px var(--color-shadow);cursor: pointer;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;position: relative;overflow: hidden;}.btn:hover {transition: all .05s;background: var(--color-primary-darker);}.btn.btn-down, .btn:active {transition: all .05s;background: var(--color-primary-dark);box-shadow: 0 0 1px var(--color-shadow);}.btn.disabled {background: var(--color-primary-light);}.dialog .btn {margin: 10px 0;}.btn-big {padding: 5px;}.tab {display: inline-block;color: var(--color-text-gray);margin: 0 5px;}.tab.active {color: var(--color-text);}*[hidden] {display: none !important;}.context-menu {position: absolute;overflow: hidden;background: var(--color-bg);border: solid 1px #777;box-shadow: 0 0px 12px var(--color-shadow);min-width: 100px;max-width: 450px;outline: none;z-index: 10001;animation: context-menu-in .2s ease-out forwards;will-change: transform;}.context-menu .item.dangerous {transition: color .3s, background .3s;color: red;}.context-menu .item.dangerous:hover {transition: color .1s, background .1s;background: red;color: white;}@keyframes context-menu-in {0% {transform: scale(.9);}100% {transform: scale(1);}}*.menu-shown {background: var(--color-bg-dd);}.menu-info {white-space: pre-wrap;color: var(--color-text-gray);padding: 5px 10px;/* animation: showing .3s; */cursor: default;}.toasts-container {position: absolute;bottom: 0;right: 0;padding: 5px;width: 300px;z-index: 10001;overflow: hidden;}.toast {margin: 5px;padding: 10px;border-radius: 5px;box-shadow: 0 0 10px var(--color-shadow);background: var(--color-bg);white-space: pre-wrap;animation: showing-right .3s;}.fading-out {transition: opacity .3s;opacity: 0;pointer-events: none;}.anchor-bottom {transform: translate(-50%, -100%);}.tooltip {position: absolute;background: var(--color-bg);box-shadow: 0 0 5px var(--color-shadow);border-radius: 5px;padding: .2em .25em;}'}let E=!1;var I=new class{constructor(){this._currentItem=null,this._currentArray=null,this.onDragStart=new a,this.onDragEnd=new a}get currentItem(){var t,e,i;return null!==(i=null!==(t=this._currentItem)&&void 0!==t?t:null===(e=this._currentArray)||void 0===e?void 0:e[0])&&void 0!==i?i:null}get currentArray(){return this._currentItem?[this._currentItem]:this._currentArray}start(t){this._currentItem=t,console.log("drag start",t),this.onDragStart.invoke()}startArray(t){this._currentArray=t,console.log("drag start array",t),this.onDragStart.invoke()}end(){this._currentItem=null,this._currentArray=null,console.log("drag end"),this.onDragEnd.invoke()}};class L extends f{constructor(){super(...arguments),this.dragging=void 0,this._selected=!1,this.onSelectedChanged=new a,this.enterctr=0,this.dragoverPlaceholder=null}get listview(){return this.parentView}get selectionHelper(){return this.listview.selectionHelper}get dragData(){return this.dom.textContent}get selected(){return this._selected}set selected(t){this._selected=t,this.domCreated&&this.updateDom(),this.onSelectedChanged.invoke()}remove(){this.listview&&this.listview.remove(this)}postCreateDom(){super.postCreateDom(),this.dom.setAttribute("role","listitem"),this.dom.addEventListener("click",(t=>{var e,i,o;(null===(e=this.listview)||void 0===e?void 0:e.selectionHelper.handleItemClicked(this,t))||null===(o=null===(i=this.listview)||void 0===i?void 0:i.onItemClicked)||void 0===o||o.call(i,this)})),this.dom.addEventListener("keydown",(t=>{var e,i,o,n,s,r;if("Enter"===t.code){if(t.altKey){const t=this.dom.getBoundingClientRect(),n=new MouseEvent("contextmenu",{clientX:t.left,clientY:t.top,relatedTarget:this.dom});null===(o=null!==(e=this.onContextMenu)&&void 0!==e?e:null===(i=this.listview)||void 0===i?void 0:i.onContextMenu)||void 0===o||o(this,n)}else{if(null===(n=this.listview)||void 0===n?void 0:n.selectionHelper.handleItemClicked(this,t))return;null===(r=null===(s=this.listview)||void 0===s?void 0:s.onItemClicked)||void 0===r||r.call(s,this)}t.preventDefault()}else if(!this.listview||"ArrowUp"!==t.code&&"ArrowDown"!==t.code)if(!this.listview||"PageUp"!==t.code&&"PageDown"!==t.code)!this.listview||"Home"!==t.code&&"End"!==t.code?this.listview&&this.listview.selectionHelper.handleItemKeyDown(this,t):(this.listview.get("Home"==t.code?0:this.listview.length-1).dom.focus(),t.preventDefault());else{const e="PageUp"===t.code?-1:1,i=this.listview.scrollBox,o=e>0?this.dom.offsetTop+i.offsetHeight:this.dom.offsetTop+this.dom.offsetHeight-i.offsetHeight,n=this.listview.length;let s=this;for(;e>0?o>s.dom.offsetTop+s.dom.offsetHeight:o<s.dom.offsetTop;){const t=s.position+e;if(t<0||t>=n)break;s=this.listview.get(t)}s&&s!==this&&(s.dom.focus(),t.preventDefault())}else{const e="ArrowUp"===t.code?-1:1,i=this.listview.get(this.position+e);i&&(i.dom.focus(),t.preventDefault())}})),this.dom.addEventListener("contextmenu",(t=>{var e,i,o;null===(o=null!==(e=this.onContextMenu)&&void 0!==e?e:null===(i=this.listview)||void 0===i?void 0:i.onContextMenu)||void 0===o||o(this,t)})),this.dom.addEventListener("dragstart",(t=>{var e,i;if(null!==(e=this.dragging)&&void 0!==e?e:null===(i=this.listview)||void 0===i?void 0:i.dragging){var o=[];this.selected?(o=[...this.selectionHelper.selectedItems]).sort(((t,e)=>t.position-e.position)):o=[this],I.startArray(o),t.dataTransfer.setData("text/plain",o.map((t=>t.dragData)).join("\r\n")),o.forEach((t=>t.dom.style.opacity=".5"))}else t.preventDefault()})),this.dom.addEventListener("dragend",(t=>{var e=I.currentArray;I.end(),t.preventDefault(),e.forEach((t=>t.dom.style.opacity=""))})),this.dom.addEventListener("dragover",(t=>{this.dragHandler(t,"dragover")})),this.dom.addEventListener("dragenter",(t=>{this.dragHandler(t,"dragenter")})),this.dom.addEventListener("dragleave",(t=>{this.dragHandler(t,"dragleave")})),this.dom.addEventListener("drop",(t=>{this.dragHandler(t,"drop")}))}dragHandler(t,e){var i,o,s,r,a,l,d,c;const h=I.currentItem;let u=I.currentArray;const m="drop"===e,g={source:h,target:this,sourceItems:u,event:t,drop:m,accept:!1};if(h instanceof L&&(null===(i=this.listview)||void 0===i?void 0:i.moveByDragging)&&h.listview===this.listview){t.preventDefault();const e=u.indexOf(this)>=0,i=t.clientY-this.dom.getBoundingClientRect().top>this.dom.offsetHeight/2;if(e&&m||(g.accept=i?"move-after":"move"),m){if(-1===u.indexOf(this)){let t=this.position;i&&t++;for(const e of u)e!==this&&(t>e.position&&t--,this.listview.move(e,t),t++)}}else t.dataTransfer.dropEffect="move"}const p=null!==(o=this.onDragover)&&void 0!==o?o:null===(s=this.listview)||void 0===s?void 0:s.onDragover;!g.accept&&p&&(p(g),(m||g.accept)&&t.preventDefault());const v=null!==(r=this.onContextMenu)&&void 0!==r?r:null===(a=this.listview)||void 0===a?void 0:a.onContextMenu;if(!g.accept&&h===this&&v&&(m?v(this,t):t.preventDefault()),"dragenter"===e||"dragover"==e||"dragleave"===e||m){"dragenter"===e?this.enterctr++:"dragleave"===e?this.enterctr--:"drop"===e&&(this.enterctr=0);let t=this.enterctr>0;this.toggleClass("dragover",t);let i=t&&("move"===g.accept||"move-after"===g.accept)&&g.accept;if(i!=(null!==(d=null===(l=this.dragoverPlaceholder)||void 0===l?void 0:l[1])&&void 0!==d&&d)&&(null===(c=this.dragoverPlaceholder)||void 0===c||c[0].remove(),this.dragoverPlaceholder=null,i)){this.dragoverPlaceholder=[n.buildDOM({tag:"div.dragover-placeholder"}),i];var f=this.dom;"move-after"===g.accept&&(f=f.nextElementSibling),this.dom.parentElement.insertBefore(this.dragoverPlaceholder[0],f)}}}}class A extends w{constructor(t){super(t),this.onItemClicked=null,this.dragging=!1,this.moveByDragging=!1,this.selectionHelper=new T,this._scrollBox=null,this.onItemMoved=null,this.onDragover=null,this.onContextMenu=null,this.selectionHelper.itemProvider=this}get scrollBox(){return this._scrollBox||this.dom}set scrollBox(t){this._scrollBox=t}postCreateDom(){super.postCreateDom(),this.dom.setAttribute("role","list")}add(t,e){this.addView(t,e),this.dragging&&(t.dom.draggable=!0)}remove(t,e){t=this._ensureItem(t),!e&&t.selected&&this.selectionHelper.toggleItemSelection(t),this.removeView(t)}move(t,e){var i;t=this._ensureItem(t),this.remove(t,!0),this.add(t,e),null===(i=this.onItemMoved)||void 0===i||i.call(this,t,t.position)}removeAll(){for(;this.length;)this.remove(this.length-1)}clear(){this.removeAll(),n.clearChildren(this.dom)}ReplaceChild(t){this.clear(),this.dom.appendChild(t.getDOM())}}class T{constructor(){this._enabled=!1,this.onEnabledChanged=new a,this.itemProvider=null,this.ctrlForceSelect=!1,this.selectedItems=[],this.onSelectedItemsChanged=new a,this.lastToggledItem=null}get enabled(){return this._enabled}set enabled(t){if(!!t!=!!this._enabled){for(this._enabled=t;this.selectedItems.length;)this.toggleItemSelection(this.selectedItems[0],!1);this.lastToggledItem=null,this.onEnabledChanged.invoke()}}get count(){return this.selectedItems.length}handleItemClicked(t,e){if(!this.enabled){if(!this.ctrlForceSelect||!e.ctrlKey)return!1;this.enabled=!0}if(e.shiftKey&&this.lastToggledItem&&this.itemProvider){var i=!!this.lastToggledItem.selected,o=t.position,n=this.lastToggledItem.position;o>n&&([o,n]=[n,o]);for(let t=o;t<=n;t++)this.toggleItemSelection(this.itemProvider.get(t),i);this.lastToggledItem=t}else this.toggleItemSelection(t);return e.preventDefault(),!0}handleItemKeyDown(t,e){if(!this.enabled)return!1;if(this.itemProvider&&e.ctrlKey&&"KeyA"===e.code){const t=this.itemProvider.length;for(let e=0;e<t;e++)this.toggleItemSelection(this.itemProvider.get(e),!0);return e.preventDefault(),!0}return!1}toggleItemSelection(t,e){void 0!==e&&e===!!t.selected||(t.selected?(t.selected=!1,this.selectedItems.remove(t),this.onSelectedItemsChanged.invoke("remove",t)):(t.selected=!0,this.selectedItems.push(t),this.onSelectedItemsChanged.invoke("add",t)),this.lastToggledItem=t,0===this.count&&this.ctrlForceSelect&&(this.enabled=!1))}}class S extends f{createDom(){return{tag:"div.overlay"}}setCenterChild(t){return this.toggleClass("centerchild",t),this}setNoBg(t){return this.toggleClass("nobg",t),this}setFixed(t){return this.toggleClass("fixed",t),this}}class O extends L{constructor(t){super(),this.text="",this.cls="normal",this.onclick=null,n.objectApply(this,t)}createDom(){return{tag:"div.item.no-selection",tabIndex:0}}postCreateDom(){super.postCreateDom(),this.onactive=t=>{var e;this.parentView instanceof z&&(this.parentView.keepOpen||this.parentView.close()),null===(e=this.onclick)||void 0===e||e.call(this,t)}}updateDom(){this.dom.textContent=this.text,this.cls!==this._lastcls&&(this._lastcls&&this.dom.classList.remove(this._lastcls),this.cls&&this.dom.classList.add(this.cls))}}class z extends A{constructor(t){super({tag:"div.context-menu",tabIndex:0}),this.keepOpen=!1,this.useOverlay=!0,this._visible=!1,this.overlay=null,this.onClose=new a,this._originalFocused=null,null==t||t.forEach((t=>this.add(t)))}get visible(){return this._visible}postCreateDom(){super.postCreateDom(),this.dom.addEventListener("focusout",(t=>{!this.dom.contains(t.relatedTarget)&&this.close()})),this.dom.addEventListener("keydown",(t=>{"Escape"===t.code&&(t.preventDefault(),this.close())}))}show(t){if(this._visible)console.warn("[ContextMenu] show() called when it's already visible.");else{"ev"in t&&(t={x:t.ev.clientX,y:t.ev.clientY}),this._visible=!0,this.useOverlay?(this.overlay||(this.overlay=(new S).setFixed(!0),this.overlay.dom.style.background="rgba(0, 0, 0, .1)",this.overlay.dom.addEventListener("mousedown",(t=>{t.eventPhase===Event.AT_TARGET&&(t.preventDefault(),this.close())}))),this.overlay.appendView(this),document.body.appendChild(this.overlay.dom)):document.body.appendChild(this.dom),this._originalFocused=document.activeElement,this.dom.focus();var e=this.dom.offsetWidth,i=this.dom.offsetHeight,o=document.body.offsetWidth,n=document.body.offsetHeight;if(this.useOverlay){const t=this.overlay.dom;o=t.offsetWidth,n=t.offsetHeight}var s=t.x,r=t.y;s+e>o&&(s-=e),r+i>n&&(r-=i),s<0&&(s=0),r<0&&(r=0),this.dom.style.left=s+"px",this.dom.style.top=r+"px",this.dom.style.transformOrigin=`${t.x-s}px ${t.y-r}px`}}close(){var t,e;this._visible&&(this._visible=!1,this.onClose.invoke(),null===(e=null===(t=this._originalFocused)||void 0===t?void 0:t.focus)||void 0===e||e.call(t),this._originalFocused=null,this.overlay&&n.fadeout(this.overlay.dom),n.fadeout(this.dom))}}class M extends f{constructor(){super(),this.content=new w({tag:"div.dialog-content"}),this.shown=!1,this.btnTitle=new F({active:!0,clickable:!1}),this.btnClose=new F({text:k`Close`,right:!0}),this.title="Dialog",this.allowClose=!0,this.showCloseButton=!0,this.onShown=new a,this.onClose=new a,this.focusTrap=new f({tag:"div.focustrap",tabIndex:0}),this.btnClose.onClick.add((()=>this.allowClose&&this.close()))}static get defaultParent(){return M._defaultParent||(M._defaultParent=new V),M._defaultParent}static set defaultParent(t){M._defaultParent=t}get width(){return this.dom.style.width}set width(t){this.dom.style.width=t}get contentFlex(){return this.content.dom.classList.contains("flex")}set contentFlex(t){this.content.toggleClass("flex",!!t)}get resizable(){return this.dom.classList.contains("resize")}set resizable(t){this.toggleClass("resize",!!t)}createDom(){return{_ctx:this,_key:"dialog",tag:"div.dialog",tabIndex:0,style:"width: 300px",child:[{_key:"domheader",tag:"div.dialog-title",child:[{tag:"div",style:"clear: both;"}]},this.content,this.focusTrap]}}postCreateDom(){super.postCreateDom(),this.addBtn(this.btnTitle),this.addBtn(this.btnClose),this.overlay=(new S).setCenterChild(!0).setNoBg(!0),this.overlay.dom.appendView(this),this.overlay.dom.addEventListener("mousedown",(t=>{this.allowClose&&0===t.button&&t.target===this.overlay.dom&&(t.preventDefault(),this.close())})),this.overlay.dom.addEventListener("keydown",(t=>{if(this.allowClose&&27===t.keyCode)t.preventDefault(),this.close();else if(t.target===this.dom&&"Tab"===t.code&&t.shiftKey){t.preventDefault();let e=this.dom.querySelectorAll("a, [tabindex]");e.length>=2&&e[e.length-2].focus&&e[e.length-2].focus()}}));{let t;n.listenPointerEvents(this.domheader,(e=>{if("down"===e.action){if(e.ev.target!==this.domheader&&e.ev.target!==this.btnTitle.dom)return;e.ev.preventDefault();const i=this.overlay.dom.getBoundingClientRect(),o=this.dom.getBoundingClientRect();return t={x:e.point.pageX-i.x-o.x,y:e.point.pageY-i.y-o.y},"track"}if("move"===e.action){e.ev.preventDefault();const i=this.overlay.dom.getBoundingClientRect(),o=n.numLimit(e.point.pageX,i.left,i.right),s=n.numLimit(e.point.pageY,i.top,i.bottom);this.setOffset(o-t.x,s-t.y)}}))}this.focusTrap.dom.addEventListener("focus",(t=>{this.dom.focus()}))}updateDom(){this.btnTitle.updateWith({text:this.title}),this.btnTitle.hidden=!this.title,this.btnClose.hidden=!(this.allowClose&&this.showCloseButton)}addBtn(t){this.ensureDom(),this.domheader.insertBefore(t.dom,this.domheader.lastChild)}addContent(t,e){this.ensureDom(),e&&this.content.removeAllView(),this.content.appendView(f.getView(t))}setOffset(t,e){this.dom.style.left=t?t+"px":"",this.dom.style.top=e?e+"px":"",this.overlay.setCenterChild(!1)}getOffset(){return{x:this.dom.style.left?parseFloat(this.dom.style.left):0,y:this.dom.style.top?parseFloat(this.dom.style.top):0}}center(){this.setOffset(0,0),this.overlay.setCenterChild(!0)}show(t){var e;this.shown||(this.shown=!0,null===(e=this._cancelFadeout)||void 0===e||e.call(this),this.ensureDom(),M.defaultParent.onDialogShowing(this),this.setTransformOrigin(t),this.dom.focus(),(this.autoFocus||this).dom.focus(),this.onShown.invoke())}setTransformOrigin(t){if(t){const e=this.dom.getBoundingClientRect();this.dom.style.transformOrigin=`${t.x-e.x}px ${t.y-e.y}px`}else this.dom.style.transformOrigin=""}close(){this.shown&&(this.shown=!1,this.setTransformOrigin(void 0),this.onClose.invoke(),this._cancelFadeout=n.fadeout(this.overlay.dom).cancel,M.defaultParent.onDialogClosing(this))}waitClose(){return new Promise((t=>{var e=this.onClose.add((()=>{this.onClose.remove(e),t()}))}))}}M._defaultParent=null;class V extends f{constructor(t){super(null!=t?t:document.body),this.bgOverlay=new S,this.dialogCount=0,this._cancelFadeout=null}onDialogShowing(t){var e;0==this.dialogCount++&&(null===(e=this._cancelFadeout)||void 0===e||e.call(this),this.appendView(this.bgOverlay)),this.appendView(t.overlay)}onDialogClosing(t){0==--this.dialogCount&&(this._cancelFadeout=n.fadeout(this.bgOverlay.dom).cancel)}}class F extends f{constructor(t){super(),this.text="",this.clickable=!0,this.active=!1,this.right=!1,this.onclick=null,this.onClick=new a,n.objectApply(this,t)}createDom(){return{tag:"span.tab.no-selection"}}postCreateDom(){this.onactive=t=>{var e;null===(e=this.onclick)||void 0===e||e.call(this,t),this.onClick.invoke(t)}}updateDom(){this.dom.textContent=this.text,this.dom.tabIndex=this.clickable?0:-1,this.toggleClass("clickable",this.clickable),this.toggleClass("active",this.active),this.dom.style.float=this.right?"right":"left"}}class P extends f{constructor(t){super(),this.multiline=!1,this.type="text",this.placeholder="",n.objectApply(this,t)}get value(){return this.dom.value}set value(t){this.dom.value=t}createDom(){return this.multiline?{tag:"textarea.input-text"}:{tag:"input.input-text"}}updateDom(){super.updateDom(),this.dom instanceof HTMLInputElement&&(this.dom.type=this.type,this.dom.placeholder=this.placeholder)}}class B extends f{get text(){return this.dom.textContent}set text(t){this.dom.textContent=t}}class j extends f{constructor(t){super(),this.label="",n.objectApply(this,t)}get dominput(){return this.input.dom}createDom(){return{_ctx:this,tag:"div.labeled-input",child:[{tag:"div.input-label",text:()=>this.label},this.input]}}updateDom(){super.updateDom(),this.input.domCreated&&this.input.updateDom()}}!function(t){t.FlagsInput=class extends w{constructor(t){super(),null==t||t.forEach((t=>{var i=t instanceof e?t:new e({text:Object.prototype.toString.call(t)});this.addView(i)}))}createDom(){return{tag:"div.flags-input"}}};class e extends B{get parentInput(){return this.parentView}constructor(t){super(),n.objectApply(this,t)}createDom(){return{tag:"div.flags-input-item"}}}t.Flag=e}(t.FlagsInput||(t.FlagsInput={}));class H extends f{constructor(){super(...arguments),this.parentDom=null,this.toasts=[]}createDom(){return{tag:"div.toasts-container"}}addToast(t){0===this.toasts.length&&this.show(),this.toasts.push(t)}removeToast(t){this.toasts.remove(t),0===this.toasts.length&&this.remove()}show(){(this.parentDom||document.body).appendChild(this.dom)}remove(){this.dom.remove()}}H.default=new H;class N extends f{constructor(t){super(),this.text="",this.shown=!1,this.timer=new s((()=>this.close())),n.objectApply(this,t),this.container||(this.container=H.default)}show(t){this.shown||(this.container.addToast(this),this.container.appendView(this),this.shown=!0),t?this.timer.timeout(t):this.timer.tryCancel()}close(){this.shown&&(this.shown=!1,n.fadeout(this.dom).onFinished((()=>this.container.removeToast(this))))}createDom(){return{tag:"div.toast"}}updateDom(){this.dom.textContent=this.text}static show(t,e){var i=new N({text:t});return i.show(e),i}}t.BuildDOMCtx=l,t.ButtonView=class extends B{constructor(t){super(),this.disabled=!1,this.type="normal",n.objectApply(this,t),this.updateDom()}get onclick(){return this.onactive}set onclick(t){this.onactive=t}createDom(){return{tag:"div.btn",tabIndex:0}}updateDom(){super.updateDom(),this.toggleClass("disabled",this.disabled),this.toggleClass("btn-big","big"===this.type)}},t.Callbacks=a,t.CancelToken=class{constructor(){this.cancelled=!1,this.onCancelled=new a}cancel(){this.cancelled||(this.cancelled=!0,this.onCancelled.invoke())}throwIfCancelled(){if(this.cancelled)throw new Error("operation cancelled.")}},t.ContainerView=w,t.ContextMenu=z,t.DataUpdatingHelper=class{update(t){const e=this.items;var i={};for(const e of t)i[this.dataSelectId(e)]=e;var o={},n=[];for(const t of e){const e=this.selectId(t);void 0!==i[e]?o[e]=t:n.push(t)}for(let t=n.length-1;t>=0;t--)this.removeItem(n[t]);var s=0;for(const e of t){const t=o[this.dataSelectId(e)];void 0!==t?this.updateItem(t,e):this.addItem(e,s),s++}}updateOrRebuildAll(t){this.update(t),this.isSame(t)||this.rebuildAll(t)}isSame(t){var e=this.items[Symbol.iterator]();for(const o of t){var i=e.next();if(i.done)return!1;if(this.selectId(i.value)!==this.dataSelectId(o))return!1}return!!e.next().done}rebuildAll(t){var e=this.items;if(e instanceof Array)for(let t=e.length-1;t>=0;t--)this.removeItem(e[t]);else for(const t of e)this.removeItem(t);let i=0;for(const e of t)this.addItem(e,i++)}selectId(t){return t.id}dataSelectId(t){return t.id}addItem(t,e){}updateItem(t,e){}removeItem(t){}},t.Dialog=M,t.DialogParent=V,t.EditableHelper=class{constructor(t){this.editing=!1,this.beforeEdit=null,this.onComplete=null,this.element=t}startEdit(t){if(!this.editing){this.editing=!0;var e=this.element,i=this.beforeEdit=e.textContent;n.toggleClass(e,"editing",!0);for(var o=n.buildDOM({tag:"input",type:"text",value:i});e.firstChild;)e.removeChild(e.firstChild);e.appendChild(o),o.select(),o.focus();var s=()=>{var i;this.editing=!1,n.toggleClass(e,"editing",!1),r.forEach((t=>t.remove())),o.remove(),null===(i=this.onComplete)||void 0===i||i.call(this,o.value),null==t||t(o.value)},r=[n.listenEvent(o,"keydown",(t=>{"Enter"===t.code&&(s(),t.preventDefault())})),n.listenEvent(o,"focusout",(t=>{s()}))]}}startEditAsync(){return new Promise((t=>this.startEdit(t)))}},t.EventRegistrations=class{constructor(){this.list=[]}add(t,e){return this.list.push({event:t,func:e}),t.add(e),e}removeAll(){for(;this.list.length;){var t=this.list.pop();t.event.remove(t.func)}}},t.I=k,t.I18n=b,t.InputStateTracker=class{constructor(t){this.dom=t,this.state={mouseDown:!1,mouseIn:!1,focusIn:!1},this._removeEvents=null,this._removePointerEvents=null,this.onChanged=new a,this._removeEvents=n.listenEvents(t,["mouseenter","mouseleave","focusin","focusout"],(t=>{switch(t.type){case"mouseenter":this.stateChanged("mouseIn",!0);break;case"mouseleave":this.stateChanged("mouseIn",!1);break;case"focusin":this.stateChanged("focusIn",!0);break;case"focusout":this.stateChanged("focusIn",!1)}})).remove,this._removePointerEvents=n.listenPointerEvents(t,(t=>{if("down"==t.action)return this.stateChanged("mouseDown",!0),"track";"up"==t.action&&this.stateChanged("mouseDown",!1)})).remove}stateChanged(t,e){this.state[t]=e,this.onChanged.invoke(t)}removeListeners(){var t,e;null===(t=this._removeEvents)||void 0===t||t.call(this),null===(e=this._removePointerEvents)||void 0===e||e.call(this),this._removePointerEvents=this._removeEvents=null}},t.InputView=P,t.ItemActiveHelper=class{constructor(t){this.funcSetActive=(t,e)=>t.toggleClass("active",e),this.current=null,n.objectApply(this,t)}set(t){this.current!==t&&(this.current&&this.funcSetActive(this.current,!1),this.current=t,this.current&&this.funcSetActive(this.current,!0))}},t.JsxNode=m,t.LabeledInput=class extends j{constructor(t){super(),n.objectApply(this,t),this.input||(this.input=new P)}get value(){return this.dominput.value}set value(t){this.dominput.value=t}updateDom(){this.input.type=this.type,super.updateDom()}},t.LabeledInputBase=j,t.Lazy=class{constructor(t){this._func=t,this._value=void 0}get computed(){return!this._func}get rawValue(){return this._value}get value(){return this._func&&(this._value=this._func(),this._func=void 0),this._value}},t.LazyListView=class extends A{constructor(){super(...arguments),this._loaded=0,this._lazy=!1,this._slowLoading=null,this._autoLoad=null}get loaded(){return this.loaded}get slowLoading(){return this._slowLoading}get autoLoad(){return this._autoLoad}get lazy(){return this._lazy}set lazy(t){this._lazy=t,t||this.ensureLoaded(this.length-1)}ensureLoaded(t){for(t>=this.length&&(t=this.length-1);this._loaded<=t;)this.dom.appendChild(this.items[this._loaded].dom),this._loaded++}loadNext(t=50){return this._loaded<this.length&&(this.ensureLoaded(Math.min(this.length-1,this._loaded+t-1)),!0)}slowlyLoad(t=30,e=50,i=!1){return i&&this.enableAutoLoad(t,e),this._slowLoading?this._slowLoading:this._loaded>=this.length?Promise.resolve(!0):this._slowLoading=new Promise((i=>{var o,n,s=()=>{this._slowLoading&&this.loadNext(e)?n():(this.lazy=!!this._autoLoad,o(),i(!!this._slowLoading),this._slowLoading=null)};if(-1==t&&window.requestIdleCallback){let t;o=()=>window.cancelIdleCallback(t),(n=()=>{t=window.requestIdleCallback(s)})()}else{-1==t&&(t=30);let e=setInterval(s,t);o=()=>clearInterval(e),n=()=>{}}}))}enableAutoLoad(t=30,e=50){this._autoLoad={interval:t,batchSize:e},this.slowlyLoad(t,e)}stopLoading(){this._slowLoading=null,this._autoLoad=null}unload(){this.stopLoading();for(let t=this._loaded-1;t>=0;t--)this.items[t].dom.remove();this.lazy=!0,this._loaded=0}_insertToDom(t,e){!this.lazy||e<this._loaded-1?(super._insertToDom(t,e),this._loaded++):this._autoLoad&&this.slowlyLoad(this._autoLoad.interval,this._autoLoad.batchSize)}_removeFromDom(t){t.position<this._loaded&&(super._removeFromDom(t),this._loaded--)}},t.ListView=A,t.ListViewItem=L,t.LoadingIndicator=class extends f{constructor(t){super(),this._status="running",this.onclick=null,t&&n.objectApply(this,t)}get state(){return this._status}set state(t){this._status=t,["running","error","normal"].forEach((e=>this.toggleClass(e,t===e)))}get content(){return this._text}set content(t){this._text=t,this.ensureDom(),this._textdom.textContent=t}reset(){this.state="running",this.content=k`Loading`,this.onclick=null}error(t,e){this.state="error",this.content=k`Oh no! Something just goes wrong:`+"\r\n"+t,e&&(this.content+="\r\n"+k`[Click here to retry]`),this.onclick=e}action(t){return _(this,void 0,void 0,(function*(){try{yield t()}catch(e){this.error(e,(()=>this.action(t)))}}))}createDom(){return{_ctx:this,tag:"div.loading-indicator",child:[{tag:"div.loading-indicator-inner",child:[{tag:"div.loading-indicator-text",_key:"_textdom"}]}],onclick:t=>this.onclick&&this.onclick(t)}}postCreateDom(){this.reset()}},t.MenuInfoItem=class extends O{constructor(t){super(t),this.text="",n.objectApply(this,t)}createDom(){return{tag:"div.menu-info"}}updateDom(){super.updateDom(),this.dom.textContent=this.text}},t.MenuItem=O,t.MenuLinkItem=class extends O{constructor(t){super(t),this.link="",this.download="",n.objectApply(this,t)}createDom(){var t=super.createDom();return t.tag="a.item.no-selection",t.target="_blank",t}updateDom(){super.updateDom(),this.dom.href=this.link,this.dom.download=this.download}},t.MessageBox=class extends M{constructor(){super(...arguments),this.allowClose=!1,this.title="Message",this.result="none"}addResultBtns(t){for(const e of t)this.addBtnWithResult(new F({text:C.get("msgbox_"+e),right:!0}),e);return this}setTitle(t){return this.title=t,this.domCreated&&this.updateDom(),this}addText(t){return this.addContent(new B({tag:"div.messagebox-text",textContent:t})),this}allowCloseWithResult(t,e){return this.result=t,this.allowClose=!0,this.showCloseButton=!!e,this.domCreated&&this.updateDom(),this}addBtnWithResult(t,e){return t.onClick.add((()=>{this.result=e,this.close()})),this.addBtn(t),this}showAndWaitResult(){return _(this,void 0,void 0,(function*(){return this.show(),yield this.waitClose(),this.result}))}},t.Overlay=S,t.Section=class extends f{constructor(t){super(),this.titleView=new B({tag:"span.section-title"}),this.headerView=new f({tag:"div.section-header",child:[this.titleView]}),this.ensureDom(),t&&(t.title&&this.setTitle(t.title),t.content&&this.setContent(t.content),t.actions&&t.actions.forEach((t=>this.addAction(t))))}createDom(){return{_ctx:this,tag:"div.section",child:[this.headerView]}}setTitle(t){this.titleView.text=t}setContent(t){for(var e=this.dom,i=e.firstChild;e.lastChild!==i;)e.removeChild(e.lastChild);e.appendChild(t.getDOM())}addAction(t){var e=new f({tag:"div.section-action.clickable",text:t.text,tabIndex:0});e.onactive=t.onclick,this.headerView.dom.appendChild(e.dom)}},t.SelectionHelper=T,t.Semaphore=class{constructor(t){this.queue=new Array,this.maxCount=1,this.runningCount=0,n.objectApply(this,t)}enter(){if(this.runningCount===this.maxCount){var t,e=new Promise((e=>{t=e}));return this.queue.push(t),e}return this.runningCount++,Promise.resolve()}exit(){this.runningCount===this.maxCount&&this.queue.length?window.queueMicrotask?window.queueMicrotask(this.queue.shift()):setTimeout(this.queue.shift(),0):this.runningCount--}run(t){return e(this,void 0,void 0,(function*(){yield this.enter();try{yield t()}finally{this.exit()}}))}},t.SettingItem=r,t.TabBtn=F,t.TextCompositionWatcher=class{constructor(t){this.isCompositing=!1,this.dom=t.getDOM(),this.dom.addEventListener("compositionstart",(t=>{this.isCompositing=!0})),this.dom.addEventListener("compositionend",(t=>{this.isCompositing=!1}))}},t.TextView=B,t.Timer=s,t.Toast=N,t.ToastsContainer=H,t.ToolTip=class extends B{constructor(){super(...arguments),this._shown=!1,this._timer=new s((()=>this.close())),this._cancelClose=null}createDom(){return{tag:"div.tooltip"}}get shown(){return this._shown}show(t){var e;if(this.shown)return;this._shown=!0,null===(e=this._cancelClose)||void 0===e||e.call(this);let{parent:i=document.body,timeout:o}=t;o&&this._timer.timeout(o);const n=this.dom;!function(t,e){let{x:i=0,y:o=0,anchor:n="bottom"}=e;t.style.left=i+"px",t.style.top=o+"px",t.classList.contains("anchor-"+n)||(t.classList.forEach((e=>{e.startsWith("anchor-")&&t.classList.remove(e)})),t.classList.add("anchor-"+n))}(n,t),i.appendChild(n)}close(t){this.shown&&(this._timer.tryCancel(),this._shown=!1,this._cancelClose=n.fadeout(this.dom,t).cancel)}},t.View=f,t.ViewToggle=class{constructor(t){this.shownKeys=[],this.toggleMode="remove",this.container=null,n.objectApply(this,t),this.setShownKeys(this.shownKeys)}add(t,e){const i=this.items[t];i?i instanceof Array?this.items[t].push(e):this.items[t]=[i,e]:this.items[t]=e,this.toggleView(e,this.shownKeys.indexOf(t)>=0)}setShownKeys(t){this.shownKeys=t;const e=this.items;for(const i in e){const o=t.indexOf(i)>=0;if(Object.prototype.hasOwnProperty.call(e,i)){const t=e[i];if(t)if(t instanceof Array)for(const e of t)this.toggleView(e,o);else t&&this.toggleView(t,o)}}}toggleView(t,e,i){if(i||(i=this.toggleMode),"display"==i)t.dom.style.display=e?"":"none";else if("hidden"==i)t.dom.hidden=!e;else{if("remove"!=i)throw new Error("Unknown toggle mode");e?this.container.appendView(t):t.dom.remove()}}},t.buildDOM=u,t.createArrayBuilder=y,t.createStringBuilder=x,t.dragManager=I,t.getWebfxCss=D,t.i18n=C,t.injectWebfxCss=function(){E||(n.injectCss(':root {--color-bg: white;--color-text: black;--color-text-gray: #666;--color-bg-selection: hsl(5, 100%, 85%);--color-primary: hsl(5, 100%, 67%);--color-primary-darker: hsl(5, 100%, 60%);--color-primary-dark: hsl(5, 100%, 40%);--color-primary-dark-depends: hsl(5, 100%, 40%);--color-primary-verydark: hsl(5, 100%, 20%);--color-primary-light: hsl(5, 100%, 83%);--color-primary-lighter: hsl(5, 100%, 70%);--color-fg-11: #111111;--color-fg-22: #222222;--color-fg-33: #333333;--color-bg-cc: #cccccc;--color-bg-dd: #dddddd;--color-bg-ee: #eeeeee;--color-bg-f8: #f8f8f8;--color-shadow: rgba(0, 0, 0, .5);}.no-selection {user-select: none;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;}/* listview item */.item {display: block;padding: 10px;/* background: #ddd; *//* animation: showing .3s forwards; */text-decoration: none;line-height: 1.2;}a.item {color: inherit;}.clickable, .item {cursor: pointer;transition: transform .3s;-webkit-tap-highlight-color: transparent;}.item:hover, .dragover {background: var(--color-bg-ee);}.keyboard-input .item:focus {outline-offset: -2px;}.dragover-placeholder {/* border-top: 2px solid gray; */position: relative;}.dragover-placeholder::before {content: "";display: block;position: absolute;transform: translate(0, -1px);height: 2px;width: 100%;background: gray;z-index: 100;pointer-events: none;}.clickable:active, .item:active {transition: transform .07s;transform: scale(.97);}.item:active {background: var(--color-bg-dd);}.item.no-transform:active {transform: none;}.item.active {background: var(--color-bg-dd);}.loading-indicator {position: relative;margin: .3em;margin-top: 3em;margin-bottom: 1em;text-align: center;white-space: pre-wrap;cursor: default;animation: loading-fadein .3s;}.loading-indicator-text {margin: 0 auto;}.loading-indicator.running .loading-indicator-inner {display: inline-block;position: relative;vertical-align: bottom;}.loading-indicator.running .loading-indicator-inner::after {content: "";height: 1px;margin: 0%;background: var(--color-text);display: block;animation: fadein .5s 1s backwards;}.loading-indicator.running .loading-indicator-text {margin: 0 .5em;animation: fadein .3s, loading-first .3s .5s cubic-bezier(0.55, 0.055, 0.675, 0.19) reverse, loading-second .3s .8s cubic-bezier(0.55, 0.055, 0.675, 0.19), loading .25s 1.1s cubic-bezier(0.55, 0.055, 0.675, 0.19) alternate-reverse infinite;}.loading-indicator.error {color: red;}.loading-indicator.fading-out {transition: max-height;animation: loading-fadein .3s reverse;}@keyframes loading-fadein {0% {opacity: 0;max-height: 0;}100% {opacity: 1;max-height: 200px;}}@keyframes fadein {0% {opacity: 0;}100% {opacity: 1;}}@keyframes loading-first {0% {transform: translate(0, -2em) scale(1) rotate(360deg);}100% {transform: translate(0, 0) scale(1) rotate(0deg);}}@keyframes loading-second {0% {transform: translate(0, -2em);}100% {transform: translate(0, 0);}}@keyframes loading {0% {transform: translate(0, -1em);}100% {transform: translate(0, 0);}}@keyframes showing {0% {opacity: .3;transform: translate(-20px, 0)}100% {opacity: 1;transform: translate(0, 0)}}@keyframes showing-top {0% {opacity: .3;transform: translate(0, -20px)}100% {opacity: 1;transform: translate(0, 0)}}@keyframes showing-right {0% {opacity: .3;transform: translate(20px, 0)}100% {opacity: 1;transform: translate(0, 0)}}.overlay {background: rgba(0, 0, 0, .2);position: absolute;top: 0;left: 0;right: 0;bottom: 0;animation: fadein .3s;z-index: 10001;overflow: hidden;contain: strict;will-change: transform;}.overlay.fixed {position: fixed;}.overlay.nobg {background: none;will-change: auto;}.overlay.centerchild {display: flex;align-items: center;justify-content: center;}.dialog * {box-sizing: border-box;}.dialog {font-size: 14px;position: relative;overflow: auto;background: var(--color-bg);border-radius: 5px;box-shadow: 0 0 12px var(--color-shadow);animation: dialogin .2s ease-out;z-index: 10001;display: flex;flex-direction: column;max-height: 100%;contain: content;will-change: transform;}.dialog.resize {resize: both;}.fading-out .dialog {transition: transform .3s ease-in;transform: scale(.85);}.dialog-title, .dialog-content, .dialog-bottom {padding: 10px;}.dialog-title {background: var(--color-bg-ee);}.dialog-content {flex: 1;padding: 5px 10px;overflow: auto;}.dialog-content.flex {display: flex;flex-direction: column;}.dialog-bottom {padding: 5px 10px;}@keyframes dialogin {0% {transform: scale(.85);}100% {transform: scale(1);}}.input-label {font-size: 80%;color: var(--color-text-gray);margin: 5px 0 3px 0;}.input-text {display: block;width: 100%;padding: 5px;border: solid 1px gray;background: var(--color-bg);color: var(--color-text);}.dialog .input-text {margin: 5px 0;}textarea.input-text {resize: vertical;}.labeled-input {display: flex;flex-direction: column;}.labeled-input .input-text {flex: 1;}.labeled-input:focus-within .input-label {color: var(--color-primary-darker);}.input-text:focus {border-color: var(--color-primary-darker);}.input-text:active {border-color: var(--color-primary-dark);}.btn {display: block;text-align: center;transition: all .2s;padding: 0 .4em;min-width: 3em;line-height: 1.5em;background: var(--color-primary);color: white;text-shadow: 0 0 4px var(--color-primary-verydark);box-shadow: 0 0 3px var(--color-shadow);cursor: pointer;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;position: relative;overflow: hidden;}.btn:hover {transition: all .05s;background: var(--color-primary-darker);}.btn.btn-down, .btn:active {transition: all .05s;background: var(--color-primary-dark);box-shadow: 0 0 1px var(--color-shadow);}.btn.disabled {background: var(--color-primary-light);}.dialog .btn {margin: 10px 0;}.btn-big {padding: 5px;}.tab {display: inline-block;color: var(--color-text-gray);margin: 0 5px;}.tab.active {color: var(--color-text);}*[hidden] {display: none !important;}.context-menu {position: absolute;overflow: hidden;background: var(--color-bg);border: solid 1px #777;box-shadow: 0 0px 12px var(--color-shadow);min-width: 100px;max-width: 450px;outline: none;z-index: 10001;animation: context-menu-in .2s ease-out forwards;will-change: transform;}.context-menu .item.dangerous {transition: color .3s, background .3s;color: red;}.context-menu .item.dangerous:hover {transition: color .1s, background .1s;background: red;color: white;}@keyframes context-menu-in {0% {transform: scale(.9);}100% {transform: scale(1);}}*.menu-shown {background: var(--color-bg-dd);}.menu-info {white-space: pre-wrap;color: var(--color-text-gray);padding: 5px 10px;/* animation: showing .3s; */cursor: default;}.toasts-container {position: absolute;bottom: 0;right: 0;padding: 5px;width: 300px;z-index: 10001;overflow: hidden;}.toast {margin: 5px;padding: 10px;border-radius: 5px;box-shadow: 0 0 10px var(--color-shadow);background: var(--color-bg);white-space: pre-wrap;animation: showing-right .3s;}.fading-out {transition: opacity .3s;opacity: 0;pointer-events: none;}.anchor-bottom {transform: translate(-50%, -100%);}.tooltip {position: absolute;background: var(--color-bg);box-shadow: 0 0 5px var(--color-shadow);border-radius: 5px;padding: .2em .25em;}',{tag:"style.webfx-injected-style"}),E=!0)},t.jsx=v,t.jsxBuild=function(t,e){return g(t,64,e||new l)},t.jsxBuildCore=g,t.jsxFactory=p,t.startBlockingDetect=function(t=20){var e=Date.now(),i=Date.now();setInterval((()=>{var o=Date.now();o-i>=t&&console.info(`[Blocking] ${(o-e)/1e3}s: blocked for ${o-i} ms`),i=o}),1)},t.utils=n,t.version="1.5.22",Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=webfx.min.js.map
