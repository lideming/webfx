!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).utils={})}(this,(function(t){"use strict";var e=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))};const n=Object.assign,i=Object.prototype.hasOwnProperty;var r=new class{constructor(){this.fileSizeUnits=["B","KB","MB","GB"],this.buildDOM=null,this.jsxFactory=null,this.jsx=null}strPadLeft(t,e,n=" "){for(;t.length<e;)t=n+t;return t}formatTime(t){if("number"!=typeof t||isNaN(t))return"--:--";t=Math.round(t);var e=Math.floor(t/60);return t%=60,this.strPadLeft(e.toString(),2,"0")+":"+this.strPadLeft(t.toString(),2,"0")}formatFileSize(t){if("number"!=typeof t||isNaN(t))return"NaN";for(var e=0;e<this.fileSizeUnits.length-1&&t>=1024;)e++,t/=1024;return t.toFixed(2)+" "+this.fileSizeUnits[e]}formatDateTime(t){var e=new Date;return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()?t.toLocaleTimeString():t.toLocaleString()}numLimit(t,e,n){return t<e||"number"!=typeof t||isNaN(t)?e:t>n?n:t}createName(t,e){for(let n=0;;n++){let i=t(n);if(!e(i))return i}}base64EncodeUtf8(t){return btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode("0x"+e)})))}sleepAsync(t){return new Promise(e=>{setTimeout(e,t)})}clearChildren(t){for(;t.lastChild;)t.removeChild(t.lastChild)}replaceChild(t,e){this.clearChildren(t),e&&t.appendChild(e)}toggleClass(t,e,n){var i=t.classList;return i.toggle?i.toggle(e,n):(void 0===n&&(n=!i.contains(e)),n?i.add(e):i.remove(e),n)}fadeout(t){t.classList.add("fading-out");var e=null,n=()=>{n&&(n=null,t.removeEventListener("transitionend",i),t.classList.remove("fading-out"),t.remove(),e&&e())},i=function(t){t.eventPhase===Event.AT_TARGET&&n()};return t.addEventListener("transitionend",i),setTimeout(n,350),{get finished(){return!n},onFinished(t){n?e=t:t()},cancel(){null==n||n()}}}listenPointerEvents(t,e,n){t.addEventListener("mousedown",(function(t){if("track"===e({type:"mouse",ev:t,point:t,action:"down"})){var n=function(t){e({type:"mouse",ev:t,point:t,action:"move"})},i=function(t){document.removeEventListener("mousemove",n,!0),document.removeEventListener("mouseup",i,!0),e({type:"mouse",ev:t,point:t,action:"up"})};document.addEventListener("mousemove",n,!0),document.addEventListener("mouseup",i,!0)}}),n);var i=!1;t.addEventListener("touchstart",(function(r){var o=r.changedTouches[0],s=e({type:"touch",touch:"start",ev:r,point:o,action:i?"move":"down"});if(!i&&"track"===s){i=!0;var a=function(t){var n=t.changedTouches[0];e({type:"touch",touch:"move",ev:t,point:n,action:"move"})},c=function(n){0===n.touches.length&&(i=!1,t.removeEventListener("touchmove",a),t.removeEventListener("touchend",c));var r=n.changedTouches[0];e({type:"touch",touch:"end",ev:n,point:r,action:i?"move":"up"})};t.addEventListener("touchmove",a,n),t.addEventListener("touchend",c,n)}}),n)}addEvent(t,e,n){return t.addEventListener(e,n),{remove:()=>t.removeEventListener(e,n)}}injectCss(t,e){var n;document.head.appendChild(r.buildDOM({tag:null!==(n=null==e?void 0:e.tag)&&void 0!==n?n:"style",text:t}))}arrayRemove(t,e){for(let n=0;n<t.length;n++)t[n]===e&&(t.splice(n,1),n--)}arrayInsert(t,e,n){void 0===n?t.push(e):t.splice(n,0,e)}arrayMap(t,e){if(t instanceof Array)return t.map(e);var n=0,i=new Array(t.length);for(var r of t)i[n]=e(r,n),n++;return i}arrayForeach(t,e){var n=0;for(var i of t)e(i,n++)}arrayFind(t,e){if(t instanceof Array)return t.find(e);var n=0;for(var i of t)if(e(i,n++))return i;return null}arraySum(t,e){var n=0;return this.arrayForeach(t,t=>{var i=e(t);i&&(n+=i)}),n}objectApply(t,e,r){if(e){if(!r)return n(t,e);for(const n in e)if(i.call(e,n)&&(!r||r.indexOf(n)>=0)){const i=e[n];t[n]=i}}return t}mod(t,e){return t<0&&(t=e+t),t%e}readBlobAsDataUrl(t){return new Promise((e,n)=>{var i=new FileReader;i.onload=t=>{e(i.result)},i.onerror=t=>n(),i.readAsDataURL(t)})}};Array.prototype.remove=function(t){r.arrayRemove(this,t)};class o{constructor(t){this.callback=t,this.cancelFunc=void 0}timeout(t){this.tryCancel();var e=setTimeout(this.callback,t);this.cancelFunc=()=>window.clearTimeout(e)}interval(t){this.tryCancel();var e=setInterval(this.callback,t);this.cancelFunc=()=>window.clearInterval(e)}animationFrame(){this.tryCancel();var t=requestAnimationFrame(this.callback);this.cancelFunc=()=>cancelAnimationFrame(t)}tryCancel(){this.cancelFunc&&(this.cancelFunc(),this.cancelFunc=void 0)}}r.Timer=o;class s{constructor(t){this.dict=null!=t?t:{}}static EnsureCtx(t,e){var n;return n=t instanceof s?t:new s(t),e&&(e.actions||(e.actions=[]),n.actions=e.actions),n}setDict(t,e){this.dict||(this.dict={}),this.dict[t]=e}addUpdateAction(t){this.actions||(this.actions=[]),this.actions.push(t)}update(){if(this.actions)for(const t of this.actions)s.executeAction(t)}static executeAction(t){switch(t[0]){case"text":t[1].textContent=t[2]();break;case"hidden":t[1].hidden=t[2]();break;case"update":t[2](t[1]);break;default:console.warn("unknown action",t)}}}function a(t,e){if("string"==typeof t)return document.createTextNode(t);if("function"==typeof t){const n=t();if(n&&"object"==typeof n)throw new Error("Unexpected function return value");{const i=document.createTextNode(n);return null==e||e.addUpdateAction(["text",i,t]),i}}return Node&&t instanceof Node?t:null}var c=function(t,e,n){if(e--<0)throw new Error("ran out of TTL");var i=a(t,n);if(i)return i;if(t instanceof d)return t.buildDom(n,e);if("getDOM"in t)return t.getDOM();const r=t.tag;if(!r)throw new Error("no tag");var o=function(t){for(var e,n,i=/[#\.^]?[\w\-]+/y;e=i.exec(t);){var r=e[0],o=r[0];if("."===o)n.classList.add(r.substr(1));else if("#"===o)n.id=r.substr(1);else{if(n)throw new Error("unexpected multiple tags");n=document.createElement(r)}}return n}(r);for(var c in t._ctx&&(n=s.EnsureCtx(t._ctx,n)),t)if(t.hasOwnProperty(c)){var l=t[c];u(c,l,o,n,e)}const h=t.init;return h&&h(o),o},u=function(t,e,n,i,r){"child"===t?e instanceof Array?e.forEach((function(t){t instanceof Array?t.forEach((function(t){n.appendChild(c(t,r,i))})):n.appendChild(c(t,r,i))})):n.appendChild(c(e,r,i)):"_key"===t?i.setDict(e,n):"text"===t?"function"==typeof e?i.addUpdateAction(["text",n,e]):n.textContent=e:"class"===t?n.className=e:"hidden"===t&&"function"==typeof e?i.addUpdateAction(["hidden",n,e]):"update"===t&&"function"==typeof e?i.addUpdateAction(["update",n,e]):"init"===t||(n[t]=e)};const l=r.buildDOM=function(t,e){return c(t,32,e)};class d{constructor(t,e,n){this.tag=t,this.attrs=e,this.child=n}getDOM(){return this.buildDom(null,64)}_getDOMExpr(){return Object.assign({tag:this.tag,child:this.child},this.attrs)}buildDom(t,e){return this.buildView(t,e).getDOM()}buildView(t,e){if(e--<0)throw new Error("ran out of TTL");if("string"==typeof this.tag)return c(this._getDOMExpr(),e,t);if(this.child)for(const n of this.child)n instanceof Array?n.forEach(n=>this.tag.addChild(h(n,e,t))):this.tag.addChild(h(n,e,t));return this.tag}addChild(t){null==this.child&&(this.child=[]),this.child.push(t)}}function h(t,e,n){if(e--<0)throw new Error("ran out of TTL");var i=a(t,n);if(i)return i;if(t instanceof d)return t.buildView(n,e);throw new Error("Unknown node type")}function f(t,e,...n){return"string"==typeof t?new d(t,e,n):new d(new t(e),void 0,n)}const v=r.jsx=r.jsxFactory=f;class p{constructor(t,e,n){if(this.onRender=null,this.key=t,!(e=this.type="string"==typeof e?p.types[e]:e)||!e.serialize||!e.deserialize)throw new Error("invalid 'type' arugment");this.readFromStorage(n)}readFromStorage(t){var e=this.key?localStorage.getItem(this.key):null;this.isInitial=!e,this.set(e?this.type.deserialize(e):t,!0)}render(t,e){e||t(this.data);const n=this.onRender,i=t;return n&&(t=function(t){n(t),i(t)}),this.onRender=t,this}bindToBtn(t,e){if(this.type!==p.types.bool)throw new Error("only for bool type");var n=document.createElement("span");t.insertBefore(n,t.firstChild),this.render((function(i){t.classList.toggle("disabled",!i),e=e||["❌","✅"],n.textContent=e[+i]}));var i=this;return t.addEventListener("click",(function(){i.toggle()})),this}remove(){localStorage.removeItem(this.key)}save(){this.isInitial=!1,localStorage.setItem(this.key,this.type.serialize(this.data))}set(t,e){this.data=t,this.isInitial=!1,this.onRender&&this.onRender(t),!e&&this.key&&this.save()}get(){return this.data}toggle(){if(this.type!==p.types.bool)throw new Error("only for bool type");this.set(!this.data)}loop(t){var e=this.data,n=t.findIndex((function(t){return t===e})),i=t[(n+1)%t.length];this.set(i)}}p.types={bool:{serialize:function(t){return t?"true":"false"},deserialize:function(t){return"true"===t||"false"!==t&&void 0}},str:{serialize:function(t){return t},deserialize:function(t){return t}},json:{serialize:function(t){return JSON.stringify(t)},deserialize:function(t){return JSON.parse(t)}}};class m{constructor(){this.list=null}invoke(...t){var e;null===(e=this.list)||void 0===e||e.forEach(e=>e.apply(this,t))}add(t){return this.list?this.list.push(t):this.list=[t],t}remove(t){this.list&&this.list.remove(t)}}class g{constructor(){this.data={},this.curLang="en",this.missing=new Map}get(t,e){return this.get2(t,e)||t}get2(t,e,n){n=n||this.curLang;var i=this.data[n];if(!i)return console.log("i18n missing lang: "+n),null;var r=i[t];if(!r)return this.missing.has(t)||(this.missing.set(t,1),console.log("i18n missing key: "+t)),null;if(e)for(const t in e)if(e.hasOwnProperty(t)){const n=e[t];r=r.replace("{"+t+"}",n)}return r}add2dArray(t){const e=[],n=t[0];for(const t of n)e.push(this.data[t]=this.data[t]||{});for(let n=1;n<t.length;n++){const i=t[n],r=i[0];for(let t=0;t<i.length;t++){const n=i[t];e[t][r]=n}}}renderElements(t){console.log("i18n elements rendering"),t.forEach(t=>{for(const n of t.childNodes)if(n.nodeType===Node.TEXT_NODE){var e=this.get2(n.beforeI18n||n.textContent);e?(n.beforeI18n=n.beforeI18n||n.textContent,n.textContent=e):(n.beforeI18n&&(n.textContent=n.beforeI18n),console.log("missing key for node",n))}})}static detectLanguage(t){var e=null,n=-1,i=[];return(navigator.languages||[navigator.language]).forEach(t=>{i.push(t),t.indexOf("-")>0&&i.push(t.substr(0,t.indexOf("-")))}),t.forEach(t=>{var r=i.indexOf(t);(!e||-1!==r&&r<n)&&(e=t,n=r)}),e||t[0]}}function y(t){var e=w(t);return function(n,...i){return 0===i.length?t.get(n[0]):e(n,...i).join("")}}function w(t){var e=new WeakMap,n=new Map;return function(i,...r){if(0===r.length)return[t.get(i[0])];let o=e.get(i);if(void 0===o){o="";for(let t=0;t<i.length;t++){o+=i[t],t<r.length&&(o+="{"+t+"}")}e.set(i,o)}const s=t.get(o);let a=n.get(s);return void 0===a&&(a=function(t){const e=[];let n=0,i="";for(let r=0;r<t.length;r++){const o=t[r];switch(o){case"{":if(0==n)n=1;else{if(1!=n)throw new Error(`Expected number, got '${o}' at ${r}`);n=0,i+="{"}break;case"}":if(3==n)n=0,e.push(+i),i="";else if(0==n)n=2;else{if(2!=n)throw new Error(`Expected number, got '${o}' at ${r}`);n=0,i+="}"}break;default:if(2==n)throw new Error(`Expected '}', got '${o}' at ${r}`);1==n&&(n=3,i&&e.push(i),i=""),i+=o}}if(0!=n)throw new Error("Unexpected end of template string");i&&e.push(i);return e}(s)),a.map(t=>"number"==typeof t?r[t]:t)}}var x=new g;const E=y(x);t.BuildDOMCtx=s,t.Callbacks=m,t.CancelToken=class{constructor(){this.cancelled=!1,this.onCancelled=new m}cancel(){this.cancelled||(this.cancelled=!0,this.onCancelled.invoke())}throwIfCancelled(){if(this.cancelled)throw new Error("operation cancelled.")}},t.DataUpdatingHelper=class{update(t){const e=this.items;var n={};for(const e of t)n[this.dataSelectId(e)]=e;var i={},r=[];for(const t of e){const e=this.selectId(t);void 0!==n[e]?i[e]=t:r.push(t)}for(let t=r.length-1;t>=0;t--)this.removeItem(r[t]);var o=0;for(const e of t){const t=i[this.dataSelectId(e)];void 0!==t?this.updateItem(t,e):this.addItem(e,o),o++}}selectId(t){return t.id}dataSelectId(t){return t.id}addItem(t,e){}updateItem(t,e){}removeItem(t){}},t.EventRegistrations=class{constructor(){this.list=[]}add(t,e){return this.list.push({event:t,func:e}),t.add(e),e}removeAll(){for(;this.list.length;){var t=this.list.pop();t.event.remove(t.func)}}},t.I=E,t.I18n=g,t.JsxNode=d,t.Lazy=class{constructor(t){this._func=t,this._value=void 0}get computed(){return!this._func}get rawValue(){return this._value}get value(){return this._func&&(this._value=this._func(),this._func=void 0),this._value}},t.Semaphore=class{constructor(t){this.queue=new Array,this.maxCount=1,this.runningCount=0,r.objectApply(this,t)}enter(){if(this.runningCount===this.maxCount){var t,e=new Promise(e=>{t=e});return this.queue.push(t),e}return this.runningCount++,Promise.resolve()}exit(){this.runningCount===this.maxCount&&this.queue.length?window.queueMicrotask?window.queueMicrotask(this.queue.shift()):setTimeout(this.queue.shift(),0):this.runningCount--}run(t){return e(this,void 0,void 0,(function*(){yield this.enter();try{yield t()}finally{this.exit()}}))}},t.SettingItem=p,t.TextCompositionWatcher=class{constructor(t){this.isCompositing=!1,this.dom=t.getDOM(),this.dom.addEventListener("compositionstart",t=>{this.isCompositing=!0}),this.dom.addEventListener("compositionend",t=>{this.isCompositing=!1})}},t.Timer=o,t.buildDOM=l,t.createArrayBuilder=w,t.createStringBuilder=y,t.i18n=x,t.jsx=v,t.jsxBuild=function(t,e){return h(t,64,e||new s)},t.jsxBuildCore=h,t.jsxFactory=f,t.utils=r,t.version="1.5.16",Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=webfxcore.min.js.map
